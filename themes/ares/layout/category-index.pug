extends partial/layout

block container
    include mixins/post
    .archive
        - var pageTitle = page.title != null ? page.title: __('categories_title');
        h2= pageTitle
        
        - var categories = get_categories().data.filter(category => {
        -   var postCount = category.posts.data ? category.posts.data.filter(post => post.lang === page.lang).length : 0;
        -   return postCount > 0;
        - });
        
        - var categoryGroups = {};
        - var pinyinMap = {'一':'A','二':'E','三':'S','四':'S','五':'W','六':'L','七':'Q','八':'B','九':'J','十':'S'};
        - categories.forEach(function(category) {
        -   var name = category.name;
        -   var firstChar = name.charAt(0).toUpperCase();
        -   if (/^[A-Z]/.test(firstChar)) {
        -     var groupKey = firstChar;
        -   } else if (/^[\u4e00-\u9fa5]/.test(firstChar)) {
        -     var groupKey = pinyinMap[firstChar] || '#';
        -   } else {
        -     var groupKey = '#';
        -   }
        -   if (!categoryGroups[groupKey]) categoryGroups[groupKey] = [];
        -   categoryGroups[groupKey].push(category);
        - });
        
        - Object.keys(categoryGroups).sort().forEach(function(letter) {
        -   categoryGroups[letter].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN'));
            h2.archive-year= letter
            - categoryGroups[letter].forEach(function(category) {
                - var postCount = category.posts.data ? category.posts.data.filter(post => post.lang === page.lang).length : 0;
                .post-item
                    .post-info
                        span.category-count= `(${postCount})`
                    - var categoryPath = category.slug || category.name
                    a.post-title-link(href=url_for_lang(page.lang, 'categories/' + categoryPath))
                        = category.name
            - })
        - })

block copyright
    include partial/copyright